---
// Component props interface
export interface Props {
  variant?: 'primary' | 'secondary' | 'neutral' | 'clear';
  size?: 'small' | 'medium' | 'large';
  class?: string;
  tag?: 'div' | 'section' | 'article' | 'aside' | 'header' | 'footer';
}

const {
  variant = 'neutral',
  size = 'medium',
  class: className = '',
  tag = 'div',
} = Astro.props;

import { getGlassmorphicClasses } from '../utils/glassmorphic';

const allowedTags = {
  div: 'div',
  section: 'section',
  article: 'article',
  aside: 'aside',
  header: 'header',
  footer: 'footer',
} as const;
const Tag = allowedTags[tag] ?? 'div';

// Build class string
const classes = getGlassmorphicClasses(variant, size, className);
---

<Tag class={classes}>
  <slot />
</Tag>

<style>
  /* CSS Custom Properties for consistent values */
  :root {
    --glass-border-width: 1px;
    --glass-border-radius: var(--radius-3);
    --glass-transition: transform var(--ease-3) 300ms, box-shadow var(--ease-3) 300ms, border-color var(--ease-3) 300ms;
    
    /* Transparency levels */
    --glass-border-subtle: 90%;
    --glass-border-visible: 85%;
    --glass-border-hover: 88%;
    --glass-glow-subtle: 98%;
    --glass-glow-visible: 95%;
    --glass-glow-hover: 90%;
    
    /* Inset shadow transparency */
    --glass-inset-light: 60%;
    --glass-inset-dark: 85%;
    --glass-inset-hover: 50%;
  }

  /* Base glassmorphic container styles */
  .glassmorphic-container {
    /* Core glassmorphism properties */
    background: var(--glass-dark);
    backdrop-filter: blur(var(--blur-12));
    -webkit-backdrop-filter: blur(var(--blur-12));
    border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent var(--glass-border-subtle));
    border-radius: var(--glass-border-radius);
    box-shadow:
      var(--shadow-2),
      inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent var(--glass-inset-light)),
      inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent var(--glass-inset-dark));

    /* Layout and spacing */
    position: relative;
    overflow: hidden;

    /* Smooth transitions */
    transition: var(--glass-transition);

    /* GPU acceleration for better performance */
    transform: translate3d(0, 0, 0);
    will-change: transform, box-shadow;
  }

  /* Variant styles - using CSS custom properties for consistency */
  .glassmorphic-container--primary {
    background: color-mix(in oklab, var(--coral), transparent 85%);
    backdrop-filter: blur(var(--blur-20));
    -webkit-backdrop-filter: blur(var(--blur-20));
    border: var(--glass-border-width) solid color-mix(in oklab, var(--coral), transparent 92%);
    box-shadow:
      var(--shadow-3),
      inset 0 1px 0 color-mix(in oklab, var(--coral), transparent var(--glass-inset-light)),
      inset 0 -1px 0 color-mix(in oklab, var(--coral), transparent var(--glass-inset-dark)),
      0 0 0 0.5px color-mix(in oklab, var(--coral), transparent var(--glass-glow-subtle));
  }

  .glassmorphic-container--secondary {
    background: color-mix(in oklab, var(--mocha), transparent 88%);
    backdrop-filter: blur(var(--blur-16));
    -webkit-backdrop-filter: blur(var(--blur-16));
    border: var(--glass-border-width) solid color-mix(in oklab, var(--mocha), transparent var(--glass-border-subtle));
    box-shadow:
      var(--shadow-2),
      inset 0 1px 0 color-mix(in oklab, var(--mocha), transparent var(--glass-inset-light)),
      inset 0 -1px 0 color-mix(in oklab, var(--mocha), transparent var(--glass-inset-dark)),
      0 0 0 0.5px color-mix(in oklab, var(--mocha), transparent var(--glass-glow-subtle));
  }

  .glassmorphic-container--neutral {
    background: color-mix(in oklab, var(--warm-bg), transparent 75%);
    backdrop-filter: blur(var(--blur-12));
    -webkit-backdrop-filter: blur(var(--blur-12));
    border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent var(--glass-border-subtle));
    box-shadow:
      var(--shadow-1),
      inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent var(--glass-inset-hover)),
      inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent var(--glass-inset-dark));
  }

  .glassmorphic-container--clear {
    background: color-mix(in oklab, var(--warm-bg), transparent 95%);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(24px);
    border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent 95%);
    box-shadow:
      var(--shadow-1),
      inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent 80%),
      inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent 90%),
      0 0 0 0.5px color-mix(in oklab, var(--text-dark), transparent 98%);
  }

  /* Size variants */
  .glassmorphic-container--small {
    padding: var(--size-3);
    margin: var(--size-2);
  }

  .glassmorphic-container--medium {
    padding: var(--size-4);
    margin: var(--size-3);
  }

  .glassmorphic-container--large {
    padding: var(--size-6);
    margin: var(--size-4);
  }

  /* Interactive states removed - no hover effects */

  /* Focus states for accessibility */
  .glassmorphic-container:focus-within {
    outline: var(--glass-border-width) solid var(--coral);
    outline-offset: var(--glass-border-width);
    box-shadow:
      var(--shadow-3),
      0 0 0 2px color-mix(in oklab, var(--coral), transparent var(--glass-border-visible));
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .glassmorphic-container {
      transition: none;
    }

    .glassmorphic-container:hover {
      transform: none;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: more) {
    .glassmorphic-container {
      border-width: var(--glass-border-width);
      border-color: var(--text-dark);
    }

    .glassmorphic-container--primary {
      border-color: var(--coral);
    }

    .glassmorphic-container--secondary {
      border-color: var(--mocha);
    }

    .glassmorphic-container--clear {
      border-color: var(--text-dark);
    }
  }

  /* Fallback for browsers without backdrop-filter support */
  @supports not (backdrop-filter: blur(1px)) {
    .glassmorphic-container {
      background: color-mix(in oklab, var(--warm-bg), transparent 90%);
      border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent var(--glass-border-subtle));
      box-shadow:
        var(--shadow-2),
        inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent var(--glass-inset-hover)),
        inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent var(--glass-inset-dark));
    }

    .glassmorphic-container--primary {
      background: color-mix(in oklab, var(--coral), transparent 90%);
      border: var(--glass-border-width) solid color-mix(in oklab, var(--coral), transparent 92%);
      box-shadow:
        var(--shadow-3),
        inset 0 1px 0 color-mix(in oklab, var(--coral), transparent var(--glass-inset-light)),
        inset 0 -1px 0 color-mix(in oklab, var(--coral), transparent var(--glass-inset-dark)),
        0 0 0 0.5px color-mix(in oklab, var(--coral), transparent var(--glass-glow-subtle));
    }

    .glassmorphic-container--secondary {
      background: color-mix(in oklab, var(--mocha), transparent 92%);
      border: var(--glass-border-width) solid color-mix(in oklab, var(--mocha), transparent var(--glass-border-subtle));
      box-shadow:
        var(--shadow-2),
        inset 0 1px 0 color-mix(in oklab, var(--mocha), transparent var(--glass-inset-light)),
        inset 0 -1px 0 color-mix(in oklab, var(--mocha), transparent var(--glass-inset-dark)),
        0 0 0 0.5px color-mix(in oklab, var(--mocha), transparent var(--glass-glow-subtle));
    }

    .glassmorphic-container--neutral {
      background: color-mix(in oklab, var(--warm-bg), transparent 90%);
      border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent var(--glass-border-subtle));
      box-shadow:
        var(--shadow-1),
        inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent var(--glass-inset-hover)),
        inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent var(--glass-inset-dark));
    }

    .glassmorphic-container--clear {
      background: color-mix(in oklab, var(--warm-bg), transparent 98%);
      border: var(--glass-border-width) solid color-mix(in oklab, var(--text-dark), transparent 95%);
      box-shadow:
        var(--shadow-1),
        inset 0 1px 0 color-mix(in oklab, var(--warm-bg), transparent 80%),
        inset 0 -1px 0 color-mix(in oklab, var(--text-dark), transparent 90%),
        0 0 0 0.5px color-mix(in oklab, var(--text-dark), transparent 98%);
    }
  }

  /* Mobile optimizations */
  @media (max-width: 768px) {
    .glassmorphic-container {
      /* Reduce blur on mobile for better performance */
      backdrop-filter: blur(var(--blur-8));
      -webkit-backdrop-filter: blur(var(--blur-8));
    }

    .glassmorphic-container--primary {
      backdrop-filter: blur(var(--blur-12));
      -webkit-backdrop-filter: blur(var(--blur-12));
    }

    .glassmorphic-container--secondary {
      backdrop-filter: blur(var(--blur-10));
      -webkit-backdrop-filter: blur(var(--blur-10));
    }

    .glassmorphic-container--clear {
      backdrop-filter: blur(var(--blur-16));
      -webkit-backdrop-filter: blur(var(--blur-16));
    }

    /* Adjust padding for mobile */
    .glassmorphic-container--small {
      padding: var(--size-2);
      margin: var(--size-1);
    }

    .glassmorphic-container--medium {
      padding: var(--size-3);
      margin: var(--size-2);
    }

    .glassmorphic-container--large {
      padding: var(--size-4);
      margin: var(--size-3);
    }
  }

  /* Dark mode adjustments */
  @media (prefers-color-scheme: dark) {
    .glassmorphic-container {
      border-color: color-mix(in oklab, var(--warm-bg), transparent var(--glass-border-subtle));
    }

    .glassmorphic-container--neutral {
      background: color-mix(in oklab, var(--text-dark), transparent 90%);
      border-color: color-mix(in oklab, var(--warm-bg), transparent var(--glass-border-subtle));
    }

    .glassmorphic-container--clear {
      background: color-mix(in oklab, var(--warm-bg), transparent 98%);
      border-color: color-mix(in oklab, var(--text-dark), transparent 95%);
    }
  }
</style>
