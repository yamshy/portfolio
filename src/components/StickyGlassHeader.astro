---
export interface Props {
  class?: string;
}

const { class: className } = Astro.props;

// Navigation items
const navItems = [
  { href: "#hero", label: "Home" },
  { href: "#evolution", label: "Experience" },
  { href: "#projects", label: "Projects" },
  { href: "#contact", label: "Contact" },
];
---

<header class:list={["glass-header", className]} role="banner">
  <nav class="glass-nav" aria-label="Main navigation">
    <ul class="nav-list" role="list">
      {navItems.map((item) => (
        <li class="nav-item">
          <a 
            href={item.href} 
            class="nav-link"
            aria-label={`Navigate to ${item.label} section`}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </nav>
</header>

<style>
  @layer components {
    .glass-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: var(--layer-4);
      
      /* Glassmorphism effect */
      background: var(--glass-bg-primary);
      border-bottom: var(--glass-border);
      backdrop-filter: var(--glass-backdrop-blur) var(--glass-backdrop-saturate);
      box-shadow: var(--shadow-glass);
      
      /* Smooth transitions */
      transition: 
        background-color var(--duration-medium) var(--ease-glass),
        backdrop-filter var(--duration-medium) var(--ease-glass),
        box-shadow var(--duration-medium) var(--ease-glass);
    }

    /* Backdrop-filter fallback */
    @supports not (backdrop-filter: blur(12px)) {
      .glass-header {
        background: var(--glass-fallback-primary);
        border-bottom: 1px solid var(--glass-border);
      }
    }

    .glass-nav {
      max-width: var(--container-max-width);
      margin: 0 auto;
      padding: var(--size-3) var(--container-padding);
    }

    .nav-list {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--size-6);
      
      @media (--mobile-only) {
        gap: var(--size-4);
      }
    }

    .nav-item {
      position: relative;
    }

    .nav-link {
      display: inline-block;
      padding: var(--size-2) var(--size-3);
      font-weight: var(--font-weight-5);
      font-size: var(--font-size-1);
      color: var(--text-1);
      border-radius: var(--radius-button);
      transition: 
        color var(--duration-fast) var(--ease-glass),
        background-color var(--duration-fast) var(--ease-glass),
        transform var(--duration-fast) var(--ease-glass);
      
      /* Focus styles */
      &:focus-visible {
        outline: var(--border-focus);
        outline-offset: 2px;
      }
      
      /* Hover effects */
      &:hover {
        color: var(--text-accent);
        background: var(--glass-bg-secondary);
        transform: var(--transform-scale-hover);
      }
      
      /* Active state */
      &:active {
        transform: var(--transform-scale-active);
      }
      
      @media (--mobile-only) {
        padding: var(--size-1) var(--size-2);
        font-size: var(--font-size-0);
      }
    }

    /* Enhanced contrast mode */
    @media (--highContrast) {
      .glass-header {
        background: var(--surface-1);
        border-bottom: 2px solid var(--text-1);
        backdrop-filter: none;
      }
      
      .nav-link {
        border: 1px solid transparent;
        
        &:hover, &:focus-visible {
          border-color: var(--text-1);
          background: var(--surface-2);
        }
      }
    }

    /* Reduced motion preferences */
    @media (--motionNotOK) {
      .glass-header {
        transition: none;
      }
      
      .nav-link {
        transition: none;
        transform: none;
        
        &:hover, &:active {
          transform: none;
        }
      }
    }

    /* Dark mode adjustments */
    @media (--OSdark) {
      .glass-header {
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3);
      }
    }

    /* Print styles */
    @media print {
      .glass-header {
        position: static;
        background: transparent;
        backdrop-filter: none;
        box-shadow: none;
        border-bottom: 1px solid var(--text-1);
      }
    }
  }
</style>

<script>
  // Progressive enhancement for scroll behavior
  class GlassHeader extends HTMLElement {
    private header: HTMLElement;
    private lastScrollY: number = 0;
    private ticking: boolean = false;

    constructor() {
      super();
      this.header = this.querySelector('.glass-header') as HTMLElement;
      this.init();
    }

    private init(): void {
      if (!this.header) return;

      // Add scroll listener for enhanced effects
      window.addEventListener('scroll', this.handleScroll.bind(this), { passive: true });
      
      // Set initial state
      this.updateHeaderOpacity();
    }

    private handleScroll(): void {
      if (!this.ticking) {
        requestAnimationFrame(() => {
          this.updateHeaderOpacity();
          this.ticking = false;
        });
        this.ticking = true;
      }
    }

    private updateHeaderOpacity(): void {
      const scrollY = window.scrollY;
      const opacity = Math.min(0.95, 0.7 + (scrollY / 300) * 0.25);
      
      // Update CSS custom property for dynamic opacity
      this.header.style.setProperty('--dynamic-opacity', opacity.toString());
      
      this.lastScrollY = scrollY;
    }

    disconnectedCallback(): void {
      window.removeEventListener('scroll', this.handleScroll.bind(this));
    }
  }

  // Only register if custom elements are supported
  if ('customElements' in window) {
    customElements.define('glass-header', GlassHeader);
  }
</script>
