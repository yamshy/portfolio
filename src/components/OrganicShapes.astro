<div class="organic-shapes" aria-hidden="true">
  <!-- New, evenly distributed background blobs -->
  <div class="blob b0"></div>
  <!-- subtle huge backdrop -->
  <div class="blob b1"></div>
  <!-- top-left -->
  <div class="blob b2"></div>
  <!-- top-right -->
  <div class="blob b3"></div>
  <!-- center-left (behind hero) -->
  <div class="blob b4"></div>
  <!-- center-right -->
  <div class="blob b5"></div>
  <!-- bottom-left -->
  <div class="blob b6"></div>
  <!-- bottom-center -->
  <div class="blob b7"></div>
  <!-- bottom-right -->
  <div class="blob b8"></div>
  <!-- upper-center -->
  <div class="blob b9"></div>
  <!-- behind main heading -->
  <div class="blob b10"></div>
  <!-- tiny accent -->
  <div class="blob b11"></div>
  <!-- micro accent (center-left) -->
  <div class="blob b12"></div>
  <!-- micro accent (center) -->

  <!-- Organic connection lines (dynamically generated) -->
  <svg
    class="connections"
    width="100%"
    height="100%"
    preserveAspectRatio="none"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
  >
    <defs>
      <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:var(--coral);stop-opacity:0.18"
        ></stop>
        <stop offset="50%" style="stop-color:var(--mocha);stop-opacity:0.18"
        ></stop>
        <stop offset="100%" style="stop-color:var(--blue);stop-opacity:0.18"
        ></stop>
      </linearGradient>
      <g id="dynamic-gradients"></g>
    </defs>
    <g class="links" aria-hidden="true"></g>
  </svg>

  <script>
    (function () {
      function init() {
        const container = document.querySelector('.organic-shapes');
        if (!container) return;
        const svg = container.querySelector('svg.connections');
        const linksGroup = svg.querySelector('g.links');
        const dynamicGradients = svg.querySelector('#dynamic-gradients');
        const mqlReduce = window.matchMedia('(prefers-reduced-motion: reduce)');

        const blobSelectors = [
          '.b0',
          '.b1',
          '.b2',
          '.b3',
          '.b4',
          '.b5',
          '.b6',
          '.b7',
          '.b8',
          '.b9',
          '.b10',
          '.b11',
          '.b12',
        ];

        function centerOf(el) {
          const r = el.getBoundingClientRect();
          return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
        }
        function getHeroRect() {
          const hero = document.querySelector('.hero-container');
          return hero ? hero.getBoundingClientRect() : null;
        }
        function magnitude(vx, vy) {
          return Math.sqrt(vx * vx + vy * vy) || 1;
        }
        function computeControl(a, b, avoidRect, bend = 80) {
          const dx = b.x - a.x;
          const dy = b.y - a.y;
          const len = magnitude(dx, dy);
          const nx = -dy / len;
          const ny = dx / len; // perpendicular
          let sign = 1;
          if (avoidRect) {
            const mid = { x: (a.x + b.x) / 2, y: (a.y + b.y) / 2 };
            const rectCx = avoidRect.left + avoidRect.width / 2;
            const rectCy = avoidRect.top + avoidRect.height / 2;
            const distPlus = Math.hypot(
              mid.x + nx * bend - rectCx,
              mid.y + ny * bend - rectCy,
            );
            const distMinus = Math.hypot(
              mid.x - nx * bend - rectCx,
              mid.y - ny * bend - rectCy,
            );
            sign = distPlus > distMinus ? 1 : -1;
          }
          const cx = (a.x + b.x) / 2 + nx * bend * sign;
          const cy = (a.y + b.y) / 2 + ny * bend * sign;
          return { cx, cy };
        }
        function clearLinks() {
          while (linksGroup.firstChild)
            linksGroup.removeChild(linksGroup.firstChild);
        }
        function clearDynamicGradients() {
          if (!dynamicGradients) return;
          while (dynamicGradients.firstChild)
            dynamicGradients.removeChild(dynamicGradients.firstChild);
        }
        function createPath(id, a, b, avoidRect, opts) {
          const { cx, cy } = computeControl(a, b, avoidRect, opts.bend);
          const d = `M ${a.x},${a.y} Q ${cx},${cy} ${b.x},${b.y}`;
          const path = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'path',
          );
          path.setAttribute('id', id);
          path.setAttribute('d', d);
          path.setAttribute('fill', 'none');
          path.setAttribute('stroke', opts.strokePaint || 'url(#lineGradient)');
          path.setAttribute('stroke-width', opts.strokeWidth || 1.2);
          path.classList.add('link-path');
          return path;
        }
        function createPulse(pathId, r, begin, dur, fill) {
          const circ = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'circle',
          );
          circ.setAttribute('r', r);
          circ.setAttribute('class', 'pulse');
          if (fill) circ.setAttribute('fill', fill);
          if (mqlReduce.matches) return null; // skip pulses in reduced motion
          const anim = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'animateMotion',
          );
          anim.setAttribute('dur', dur);
          anim.setAttribute('repeatCount', 'indefinite');
          anim.setAttribute('rotate', 'auto');
          anim.setAttribute('begin', begin);
          const mpath = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'mpath',
          );
          mpath.setAttributeNS(
            'http://www.w3.org/1999/xlink',
            'xlink:href',
            `#${pathId}`,
          );
          anim.appendChild(mpath);
          circ.appendChild(anim);
          return circ;
        }
        const cssVar = (name) =>
          getComputedStyle(document.documentElement)
            .getPropertyValue(name)
            .trim();
        const blobColorVar = new Map([
          ['.b0', '--mocha'],
          ['.b1', '--coral'],
          ['.b2', '--mocha'],
          ['.b3', '--accent-yellow'],
          ['.b4', '--blue'],
          ['.b5', '--mocha'],
          ['.b6', '--coral'],
          ['.b7', '--blue'],
          ['.b8', '--coral'],
          ['.b9', '--coral'],
          ['.b10', '--accent-yellow'],
          ['.b11', '--blue'],
          ['.b12', '--accent-yellow'],
        ]);
        function createGradient(id, colA, colB) {
          const g = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'linearGradient',
          );
          g.setAttribute('id', id);
          g.setAttribute('x1', '0%');
          g.setAttribute('y1', '0%');
          g.setAttribute('x2', '100%');
          g.setAttribute('y2', '0%');
          const s1 = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'stop',
          );
          s1.setAttribute('offset', '0%');
          s1.setAttribute('stop-color', colA);
          s1.setAttribute('stop-opacity', '0.9');
          const s2 = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'stop',
          );
          s2.setAttribute('offset', '100%');
          s2.setAttribute('stop-color', colB);
          s2.setAttribute('stop-opacity', '0.9');
          g.appendChild(s1);
          g.appendChild(s2);
          dynamicGradients.appendChild(g);
          return `url(#${id})`;
        }
        function buildPairs(isMobile) {
          const P = (a, b) => [a, b];
          const desktop = [
            P('.b1', '.b3'),
            P('.b3', '.b9'),
            P('.b1', '.b5'),
            P('.b2', '.b4'),
            P('.b4', '.b7'),
            P('.b2', '.b8'),
            P('.b5', '.b6'),
            P('.b6', '.b7'),
            P('.b0', '.b7'),
          ];
          const mobile = [P('.b1', '.b3'), P('.b2', '.b4'), P('.b5', '.b6')];
          return isMobile ? mobile : desktop;
        }
        function rebuild() {
          const vw = window.innerWidth;
          const isMobile = vw < 900;
          clearLinks();
          clearDynamicGradients();
          const avoid = getHeroRect();
          const nodeMap = new Map();
          blobSelectors.forEach((sel) => {
            const el = container.querySelector(sel);
            if (el) nodeMap.set(sel, centerOf(el));
          });
          const pairs = buildPairs(isMobile);
          let idx = 0;
          for (const [sa, sb] of pairs) {
            const a = nodeMap.get(sa),
              b = nodeMap.get(sb);
            if (!a || !b) continue;
            const id = `conn-${idx++}`;
            // Build gradient matching the blobs' colors
            const va = blobColorVar.get(sa);
            const vb = blobColorVar.get(sb);
            const ca = va ? cssVar(va) : null;
            const cb = vb ? cssVar(vb) : null;
            const paint =
              ca && cb
                ? createGradient(`grad-${id}`, ca, cb)
                : 'url(#lineGradient)';
            const path = createPath(id, a, b, avoid, {
              bend: isMobile ? 60 : 100,
              strokeWidth: isMobile ? 1.6 : 2.4,
              strokePaint: paint,
            });
            linksGroup.appendChild(path);
            const pulseCount = isMobile ? 1 : 2;
            for (let i = 0; i < pulseCount; i++) {
              const r = isMobile ? 2.5 : 3;
              const begin = `${i * 2 + (Math.random() * 1).toFixed(2)}s`;
              const dur = `${(6 + Math.random() * 4).toFixed(2)}s`;
              const p = createPulse(id, r, begin, dur, ca || null);
              if (p) linksGroup.appendChild(p);
            }
          }
        }
        const debounced = (fn, ms = 150) => {
          let t;
          return (...args) => {
            clearTimeout(t);
            t = setTimeout(() => fn(...args), ms);
          };
        };
        rebuild();
        window.addEventListener('resize', debounced(rebuild, 150));

        // If the user toggles reduced motion in OS settings at runtime
        if (mqlReduce.addEventListener) {
          mqlReduce.addEventListener('change', () => rebuild());
        } else if (mqlReduce.addListener) {
          mqlReduce.addListener(() => rebuild());
        }

        // Pause animations when offscreen to save cycles
        const io = new IntersectionObserver(
          (entries) => {
            for (const e of entries) {
              svg.style.visibility = e.isIntersecting ? 'visible' : 'hidden';
            }
          },
          { threshold: 0 },
        );
        io.observe(container);
      }
      if (document.readyState === 'loading')
        document.addEventListener('DOMContentLoaded', init);
      else init();
    })();
  </script>
</div>

<style>
  .organic-shapes {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0; /* above page background, below content */
    overflow: hidden;
  }

  .blob {
    position: absolute;
    border-radius: 50%;
    opacity: 0.16;
    animation: organic-float 12s ease-in-out infinite;
    /* Add subtle organic variation */
    transform-origin: center;
  }

  /* Very large, faint background shape for scale variation */
  .b0 {
    width: 520px;
    height: 460px;
    background: var(--mocha);
    top: 52%;
    left: 58%;
    transform: translate(-50%, -50%);
    opacity: 0.08;
    animation: organic-float-slow 28s ease-in-out infinite;
    border-radius: 60% 40% 55% 45% / 50% 60% 40% 50%;
  }

  /* New set layout */
  .b1 {
    width: 340px;
    height: 340px;
    background: var(--coral);
    top: 8%;
    left: 4%;
    opacity: 0.16;
    animation-delay: 0.2s;
    border-radius: 58% 42% 40% 60% / 60% 40% 60% 40%;
  }

  .b2 {
    width: 200px;
    height: 200px;
    background: var(--mocha);
    top: 10%;
    right: 6%;
    opacity: 0.14;
    animation: organic-float-slow 16s ease-in-out infinite;
    animation-delay: 1.5s;
    border-radius: 42% 58% 58% 42% / 40% 60% 40% 60%;
  }

  .b3 {
    width: 150px;
    height: 150px;
    background: var(--accent-yellow);
    top: 34%;
    left: 27%;
    opacity: 0.15;
    animation: organic-breathe 12s ease-in-out infinite;
    border-radius: 50% 52% 48% 50% / 55% 45% 55% 45%;
  }

  .b4 {
    width: 240px;
    height: 240px;
    background: var(--blue);
    top: 40%;
    right: 18%;
    opacity: 0.14;
    animation: organic-drift 18s ease-in-out infinite;
    border-radius: 45% 55% 55% 45% / 55% 45% 55% 45%;
  }

  .b5 {
    width: 360px;
    height: 360px;
    background: var(--mocha);
    bottom: 8%;
    left: 10%;
    opacity: 0.14;
    animation: organic-float-slow 20s ease-in-out infinite;
    border-radius: 48% 52% 60% 40% / 50% 60% 40% 50%;
  }

  .b6 {
    width: 120px;
    height: 120px;
    background: var(--coral);
    bottom: 6%;
    left: 46%;
    opacity: 0.14;
    animation: organic-float-fast 10s ease-in-out infinite;
    animation-delay: 0.8s;
    border-radius: 60% 40% 50% 50% / 55% 45% 55% 45%;
  }

  .b7 {
    width: 300px;
    height: 300px;
    background: var(--blue);
    bottom: 10%;
    right: 8%;
    opacity: 0.14;
    animation-delay: 2s;
    border-radius: 40% 60% 60% 40% / 60% 40% 60% 40%;
  }

  .b8 {
    width: 64px;
    height: 64px;
    background: var(--coral);
    top: 22%;
    left: 54%;
    opacity: 0.18;
    animation: organic-float-fast 12s ease-in-out infinite;
    border-radius: 50% 50% 55% 45% / 45% 55% 45% 55%;
  }

  .b9 {
    width: 260px;
    height: 180px;
    background: var(--coral);
    top: 18%;
    left: 32%;
    opacity: 0.18;
    animation: organic-drift 16s ease-in-out infinite;
    animation-delay: 0.6s;
    border-radius: 60% 40% 55% 45% / 50% 60% 40% 50%;
  }

  .b10 {
    width: 40px;
    height: 40px;
    background: var(--accent-yellow);
    bottom: 26%;
    right: 35%;
    opacity: 0.18;
    animation: organic-float-fast 8s ease-in-out infinite;
    border-radius: 50%;
  }

  .b11 {
    width: 28px;
    height: 28px;
    background: var(--blue);
    top: 37%;
    left: 22%;
    opacity: 0.2;
    animation: organic-float-fast 9s ease-in-out infinite;
    border-radius: 50%;
  }

  .b12 {
    width: 36px;
    height: 36px;
    background: var(--accent-yellow);
    top: 38%;
    left: 56%;
    opacity: 0.2;
    animation: organic-breathe 11s ease-in-out infinite;
    border-radius: 50%;
  }

  /* Removed previous floating elements for a cleaner set */

  .connections {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.45; /* stronger visibility for bigger connections */
  }

  .connection-line {
    stroke-dasharray: 20 10;
    stroke-dashoffset: 0;
    animation: line-flow 6s ease-in-out infinite;
  }

  /* Style for generated links and pulses */
  .link-path {
    vector-effect: non-scaling-stroke;
    stroke-linecap: round;
    filter: drop-shadow(
      0 0 8px color-mix(in oklab, var(--mocha), transparent 85%)
    );
    stroke-dasharray: 18 12;
    animation: line-flow 7s ease-in-out infinite;
  }
  .pulse {
    fill: color-mix(in oklab, var(--coral), transparent 70%);
    opacity: 0.85;
  }
  .pulse > animateMotion + animate,
  .pulse > animate {
    pointer-events: none;
  }

  @media (prefers-reduced-motion: reduce) {
    .connections {
      opacity: 0.22;
    }
    .link-path {
      animation: none;
    }
    .pulse {
      display: none;
    }
  }

  .line-1 {
    animation-delay: 0s;
  }

  .line-2 {
    animation-delay: 2s;
  }

  .line-3 {
    animation-delay: 4s;
  }

  @keyframes organic-float {
    0%,
    100% {
      transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
    }
    25% {
      transform: translateY(-30px) translateX(10px) rotate(1deg) scale(1.02);
    }
    50% {
      transform: translateY(-15px) translateX(-5px) rotate(-0.5deg) scale(0.98);
    }
    75% {
      transform: translateY(-25px) translateX(5px) rotate(0.5deg) scale(1.01);
    }
  }

  @keyframes gentle-float {
    0%,
    100% {
      transform: translateY(0px) scale(1);
    }
    50% {
      transform: translateY(-20px) scale(1.1);
    }
  }

  /* Additional motion profiles for variety */
  @keyframes organic-float-slow {
    0%,
    100% {
      transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
    }
    25% {
      transform: translateY(-25px) translateX(8px) rotate(0.5deg) scale(1.03);
    }
    50% {
      transform: translateY(-12px) translateX(-6px) rotate(-0.5deg) scale(0.99);
    }
    75% {
      transform: translateY(-20px) translateX(4px) rotate(0.25deg) scale(1.01);
    }
  }

  @keyframes organic-float-fast {
    0%,
    100% {
      transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
    }
    50% {
      transform: translateY(-14px) translateX(6px) rotate(0.4deg) scale(1.02);
    }
  }

  @keyframes organic-drift {
    0%,
    100% {
      transform: translateY(0px) translateX(0px) rotate(0deg) scale(1);
    }
    33% {
      transform: translateY(-18px) translateX(20px) rotate(0.6deg) scale(1.01);
    }
    66% {
      transform: translateY(-10px) translateX(-14px) rotate(-0.6deg) scale(1.02);
    }
  }

  @keyframes organic-breathe {
    0%,
    100% {
      transform: scale(1) translateZ(0);
    }
    50% {
      transform: scale(1.12) translateZ(0);
    }
  }

  @keyframes line-flow {
    0%,
    100% {
      stroke-dashoffset: 0;
      opacity: 0.3;
    }
    50% {
      stroke-dashoffset: -30;
      opacity: 0.5;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .blob,
    .floating-element {
      animation: none;
    }

    .connection-line {
      animation: none;
      opacity: 0.1;
    }
  }

  /* Responsive adjustments for smaller screens */
  @media (max-width: 768px) {
    .b0 {
      width: 360px;
      height: 300px;
      top: 54%;
      left: 52%;
      opacity: 0.08;
    }
    .b1 {
      top: 6%;
      left: 2%;
      width: 220px;
      height: 220px;
      opacity: 0.12;
    }
    .b2 {
      top: 8%;
      right: 2%;
      width: 150px;
      height: 150px;
      opacity: 0.12;
    }
    .b3 {
      top: 28%;
      left: 16%;
      width: 120px;
      height: 120px;
      opacity: 0.13;
    }
    .b4 {
      top: 46%;
      right: 8%;
      width: 160px;
      height: 160px;
      opacity: 0.12;
    }
    .b5 {
      bottom: 10%;
      left: 6%;
      width: 220px;
      height: 220px;
      opacity: 0.12;
    }
    .b6 {
      bottom: 8%;
      left: 44%;
      width: 100px;
      height: 100px;
      opacity: 0.12;
    }
    .b7 {
      bottom: 12%;
      right: 4%;
      width: 200px;
      height: 200px;
      opacity: 0.12;
    }
    .b8 {
      top: 26%;
      left: 50%;
      width: 48px;
      height: 48px;
      opacity: 0.12;
    }
    .b9 {
      top: 24%;
      left: 30%;
      width: 200px;
      height: 140px;
      opacity: 0.14;
    }
    .b10 {
      bottom: 24%;
      right: 30%;
      width: 32px;
      height: 32px;
      opacity: 0.12;
    }
    .b11 {
      top: 34%;
      left: 20%;
      width: 22px;
      height: 22px;
      opacity: 0.12;
    }
    .b12 {
      top: 40%;
      left: 54%;
      width: 28px;
      height: 28px;
      opacity: 0.12;
    }
  }

  /* Hide on very small screens to avoid clutter */
  @media (max-width: 480px) {
    .organic-shapes {
      display: none;
    }
  }

  /* Print styles */
  @media print {
    .organic-shapes {
      display: none;
    }
  }
</style>
