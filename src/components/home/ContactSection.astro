---
import type { ContactChannel } from '../../content/home';

interface Props {
  channels: ContactChannel[];
}

const { channels } = Astro.props as Props;
const emailChannel = channels.find(
  (channel) => channel.label.toLowerCase() === 'email',
);
const hasEmailChannel = Boolean(emailChannel);
const mailtoHref = emailChannel?.href ?? '#';
const inboxLabel = emailChannel?.value ?? 'my inbox';
---

<section class="section section--contact" id="contact" data-reveal>
  <div class="u-container contact">
    <header class="contact__heading">
      <p class="u-title-overline">Contact</p>
      <h2>Build regulated-ready infrastructure faster</h2>
      <p class="contact__intro">
        I partner with biotech, pharmaceutical, and research organisations to
        align scientific platforms with the realities of regulated delivery.
      </p>
      <p class="contact__cta">
        Share your current initiative and I’ll respond with next steps within
        two business days.
      </p>
      <ul class="contact__meta">
        <li>
          <span>Response time</span>
          <strong>Within two business days</strong>
        </li>
        <li>
          <span>Current focus</span>
          <strong>Clinical-grade data platforms</strong>
        </li>
        <li>
          <span>Availability</span>
          <strong>Booking next quarter</strong>
        </li>
      </ul>
    </header>

    <div class="contact__details">
      <article
        class="contact__card contact__card--focus"
        aria-labelledby="contact-focus-title"
      >
        <div class="contact__card-heading">
          <h3 id="contact-focus-title">Focus areas</h3>
          <p>
            Engagements blend hands-on delivery with strategic guidance so your
            teams inherit resilient, compliant systems.
          </p>
        </div>
        <ul aria-labelledby="contact-focus-title" class="contact__focus">
          <li>Platform roadmaps for sequencing, ML, and analytics</li>
          <li>Compliance-focused technical diligence</li>
          <li>Embedded mentorship for resilient operations</li>
        </ul>
      </article>

      <article class="contact__card contact__card--process">
        <h3>Engagement snapshot</h3>
        <ol class="contact__steps">
          <li>
            <strong>Discovery workshop</strong>
            <span>
              Map regulated constraints, data flows, and desired outcomes with
              your leads in a focused 45-minute session.
            </span>
          </li>
          <li>
            <strong>Systems blueprint</strong>
            <span>
              Translate requirements into platform architecture, operational
              guardrails, and a clear build-or-augment plan.
            </span>
          </li>
          <li>
            <strong>Implementation partnership</strong>
            <span>
              Embed with your engineering teams to deliver, document, and mentor
              through launch and handover.
            </span>
          </li>
        </ol>
        <p class="contact__availability">
          Booking new collaborations for the upcoming quarter — share timelines
          early for priority alignment.
        </p>
      </article>
    </div>

    <div class="contact__panel" aria-labelledby="contact-panel-title">
      <div class="contact__panel-grid">
        <div class="contact__panel-copy">
          <div class="contact__panel-header">
            <h3 id="contact-panel-title">Start a conversation</h3>
            <p class="contact__panel-description">
              Complete the brief and I’ll follow up with a tailored delivery
              plan, or reach out directly through your preferred channel.
            </p>
          </div>

          <ul class="contact__channels">
            {
              channels.map((channel) => (
                <li>
                  <a href={channel.href}>
                    <span>{channel.label}</span>
                    <strong>{channel.value}</strong>
                  </a>
                </li>
              ))
            }
          </ul>

          <p class="contact__panel-note">
            Prefer secure tooling? Request a Signal or Matrix invite when you
            reach out.
          </p>
        </div>

        <form
          class:list={{
            contact__form: true,
            'contact__form--disabled': !hasEmailChannel,
          }}
          action={mailtoHref}
          method="POST"
          enctype="text/plain"
          target="_blank"
        >
          <div class="contact__form-row">
            <label class="contact__form-field">
              <span class="contact__form-label">Name</span>
              <input
                id="contact-name"
                name="Name"
                type="text"
                placeholder="Your name"
                required
              />
            </label>
            <label class="contact__form-field">
              <span class="contact__form-label">Work email</span>
              <input
                id="contact-email"
                name="Email"
                type="email"
                inputmode="email"
                placeholder="you@company.com"
                required
              />
            </label>
          </div>

          <div class="contact__form-row">
            <label class="contact__form-field">
              <span class="contact__form-label">Organisation</span>
              <input
                id="contact-organisation"
                name="Organisation"
                type="text"
                placeholder="Company or team"
              />
            </label>
            <label class="contact__form-field">
              <span class="contact__form-label">Timeline</span>
              <input
                id="contact-timeline"
                name="Timeline"
                type="text"
                placeholder="e.g. Q4 launch"
              />
            </label>
          </div>

          <label class="contact__form-field">
            <span class="contact__form-label">Project details</span>
            <textarea
              id="contact-message"
              name="Project details"
              rows="4"
              placeholder="What are you building? Where do you need support?"
              required></textarea>
          </label>

          <p class="contact__form-footnote">
            Submissions route straight to {inboxLabel} and receive a reply within
            two business days.
          </p>

          {
            !hasEmailChannel && (
              <p class="contact__form-alert" role="status">
                Direct email is unavailable right now. Use one of the channels
                above instead.
              </p>
            )
          }

          <button
            type="submit"
            class="contact__submit"
            disabled={!hasEmailChannel}
          >
            Send project brief
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

<style>
  .section--contact {
    background: color-mix(in oklab, var(--color-surface) 90%, transparent 10%);
  }

  .contact {
    position: relative;
    display: grid;
    gap: clamp(var(--space-xl), 6vw, var(--space-2xl));
    align-items: start;
  }

  .contact__heading {
    display: grid;
    gap: clamp(var(--space-sm), 2vw, var(--space-md));
    max-width: min(60ch, 100%);
    align-content: start;
  }

  .contact__intro {
    color: var(--color-text-muted);
  }

  .contact__cta {
    font-size: var(--text-md);
    color: var(--color-text);
  }

  .contact__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .contact__meta li {
    flex: 1 1 min(220px, 100%);
    min-width: 180px;
    padding: 0.75rem 1rem;
    border-radius: var(--radius-md);
    border: 1px solid
      color-mix(in oklab, var(--color-border) 60%, transparent 40%);
    background: color-mix(
      in oklab,
      var(--color-surface) 92%,
      var(--color-primary) 8%
    );
    display: grid;
    gap: var(--space-2xs);
  }

  .contact__meta span {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--color-text-subtle);
  }

  .contact__meta strong {
    font-size: var(--text-md);
    font-weight: 600;
  }

  .contact__details {
    display: grid;
    gap: clamp(var(--space-md), 3vw, var(--space-lg));
  }

  .contact__card {
    display: grid;
    gap: var(--space-sm);
    padding: clamp(var(--space-md), 3vw, var(--space-lg));
    border-radius: var(--radius-lg);
    border: 1px solid
      color-mix(in oklab, var(--color-border) 65%, transparent 35%);
    background: color-mix(in oklab, var(--color-surface) 94%, transparent 6%);
    box-shadow: 0 18px 36px -28px var(--color-shadow);
  }

  .contact__card-heading {
    display: grid;
    gap: var(--space-2xs);
  }

  .contact__card--focus h3 {
    margin: 0;
    font-size: var(--text-sm);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--color-text-subtle);
  }

  .contact__card--focus p {
    margin: 0;
    color: var(--color-text-muted);
  }

  .contact__card--process h3 {
    font-size: var(--heading-md);
  }

  .contact__focus {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2xs);
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .contact__focus li {
    display: inline-flex;
    align-items: center;
    padding: 0.55rem 0.85rem;
    border-radius: 999px;
    border: 1px solid
      color-mix(in oklab, var(--color-border) 60%, transparent 40%);
    background: color-mix(
      in oklab,
      var(--color-surface) 88%,
      var(--color-primary) 12%
    );
    font-size: var(--text-sm);
    line-height: 1.35;
    color: var(--color-text-muted);
  }

  .contact__steps {
    counter-reset: step;
    display: grid;
    gap: var(--space-sm);
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .contact__steps li {
    position: relative;
    display: grid;
    gap: var(--space-2xs);
    padding-inline-start: 2.6rem;
  }

  .contact__steps li::before {
    counter-increment: step;
    content: counter(step, decimal-leading-zero);
    position: absolute;
    inset-inline-start: 0;
    inset-block-start: 0.1rem;
    width: 2.1rem;
    height: 2.1rem;
    border-radius: 999px;
    background: color-mix(in oklab, var(--color-primary) 55%, transparent 45%);
    color: var(--color-text);
    display: grid;
    place-items: center;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .contact__steps strong {
    font-size: var(--text-md);
    color: var(--color-text);
  }

  .contact__steps span {
    font-size: var(--text-sm);
    color: var(--color-text-muted);
    line-height: 1.5;
  }

  .contact__availability {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text-subtle);
  }

  .contact__panel {
    position: relative;
    display: grid;
    gap: clamp(var(--space-lg), 4vw, var(--space-xl));
    padding: clamp(var(--space-xl), 5vw, var(--space-2xl));
    border-radius: var(--radius-lg);
    border: 1px solid
      color-mix(in oklab, var(--color-border) 70%, transparent 30%);
    background: color-mix(in oklab, var(--color-surface) 92%, transparent 8%);
    box-shadow: 0 32px 64px -42px var(--color-shadow);
    overflow: hidden;
    isolation: isolate;
  }

  .contact__panel::before,
  .contact__panel::after {
    content: '';
    position: absolute;
    border-radius: 999px;
    pointer-events: none;
    opacity: 0.55;
  }

  .contact__panel::before {
    inset-block-start: -25%;
    inset-inline-start: -18%;
    width: 60%;
    aspect-ratio: 1;
    background: radial-gradient(
      circle at center,
      color-mix(in oklab, var(--color-primary) 30%, transparent) 0%,
      transparent 70%
    );
    transform: rotate(-12deg);
  }

  .contact__panel::after {
    inset-block-end: -35%;
    inset-inline-end: -5%;
    width: 48%;
    aspect-ratio: 1;
    background: radial-gradient(
      circle at center,
      color-mix(in oklab, var(--color-science-green) 32%, transparent) 0%,
      transparent 72%
    );
    transform: rotate(18deg);
  }

  .contact__panel > * {
    position: relative;
  }

  .contact__panel-grid {
    display: grid;
    gap: clamp(var(--space-lg), 4vw, var(--space-xl));
  }

  .contact__panel-copy {
    display: grid;
    gap: clamp(var(--space-md), 3vw, var(--space-lg));
  }

  .contact__panel-header {
    display: grid;
    gap: var(--space-xs);
  }

  .contact__panel h3 {
    margin: 0;
    font-size: var(--heading-md);
  }

  .contact__panel-description {
    margin: 0;
    color: var(--color-text-muted);
  }

  .contact__channels {
    display: grid;
    gap: var(--space-xs);
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .contact__channels li {
    margin: 0;
  }

  .contact__channels a {
    position: relative;
    display: grid;
    gap: var(--space-2xs);
    padding: 0.9rem 1rem;
    border-radius: var(--radius-md);
    border: 1px solid
      color-mix(in oklab, var(--color-border) 55%, transparent 45%);
    background: color-mix(
      in oklab,
      var(--color-primary) 16%,
      var(--color-surface) 84%
    );
    color: inherit;
    text-decoration: none;
    box-shadow: 0 16px 28px -26px var(--color-shadow);
    transition:
      transform var(--duration-base) var(--ease-smooth),
      box-shadow var(--duration-base) var(--ease-smooth),
      border-color var(--duration-base) var(--ease-smooth);
  }

  .contact__channels a span {
    font-size: var(--text-sm);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--color-text-subtle);
  }

  .contact__channels a strong {
    font-size: var(--text-md);
    font-weight: 600;
    word-break: break-word;
  }

  .contact__channels a:hover,
  .contact__channels a:focus-visible {
    transform: translateY(-4px);
    box-shadow: 0 28px 46px -32px var(--color-shadow);
    border-color: color-mix(
      in oklab,
      var(--color-primary) 45%,
      transparent 55%
    );
  }

  .contact__channels a:focus-visible {
    outline: 2px solid
      color-mix(in oklab, var(--color-primary) 55%, transparent 45%);
    outline-offset: 4px;
  }

  .contact__panel-note {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text-subtle);
  }

  .contact__form {
    display: grid;
    gap: var(--space-sm);
    align-content: start;
  }

  .contact__form--disabled {
    opacity: 0.6;
  }

  .contact__form-row {
    display: grid;
    gap: var(--space-sm);
  }

  .contact__form-field {
    display: grid;
    gap: var(--space-2xs);
  }

  .contact__form-label {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--color-text-subtle);
  }

  .contact__form input,
  .contact__form textarea {
    width: 100%;
    padding: 0.75rem 0.9rem;
    border-radius: var(--radius-md);
    border: 1px solid
      color-mix(in oklab, var(--color-border) 55%, transparent 45%);
    background: color-mix(in oklab, var(--color-surface) 96%, transparent 4%);
    color: var(--color-text);
    font-size: var(--text-md);
    transition:
      border-color var(--duration-base) var(--ease-smooth),
      box-shadow var(--duration-base) var(--ease-smooth);
  }

  .contact__form input::placeholder,
  .contact__form textarea::placeholder {
    color: color-mix(in oklab, var(--color-text-muted) 80%, transparent 20%);
  }

  .contact__form input:focus,
  .contact__form textarea:focus {
    outline: none;
    border-color: color-mix(
      in oklab,
      var(--color-primary) 45%,
      transparent 55%
    );
    box-shadow: 0 0 0 3px
      color-mix(in oklab, var(--color-primary) 25%, transparent 75%);
  }

  .contact__form textarea {
    resize: vertical;
    min-height: 160px;
  }

  .contact__form-footnote {
    margin: 0;
    font-size: var(--text-sm);
    color: var(--color-text-subtle);
  }

  .contact__form-alert {
    margin: 0;
    padding: 0.65rem 0.9rem;
    border-radius: var(--radius-md);
    border-inline-start: 4px solid var(--color-danger);
    background: color-mix(
      in oklab,
      var(--color-danger) 18%,
      var(--color-surface) 82%
    );
    color: color-mix(in oklab, var(--color-danger) 75%, var(--color-text));
    font-size: var(--text-sm);
  }

  .contact__submit {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2xs);
    padding: 0.85rem 1.4rem;
    border-radius: var(--radius-md);
    border: none;
    background: linear-gradient(
      120deg,
      color-mix(in oklab, var(--color-primary) 85%, transparent 15%),
      color-mix(in oklab, var(--color-primary-strong) 75%, transparent 25%)
    );
    color: color-mix(in oklab, var(--color-surface) 95%, transparent 5%);
    font-size: var(--text-md);
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 22px 40px -30px var(--color-shadow);
    transition:
      transform var(--duration-base) var(--ease-smooth),
      box-shadow var(--duration-base) var(--ease-smooth),
      filter var(--duration-base) var(--ease-smooth);
  }

  .contact__submit:hover,
  .contact__submit:focus-visible {
    transform: translateY(-3px);
    box-shadow: 0 30px 50px -32px var(--color-shadow);
    filter: brightness(1.05);
  }

  .contact__submit:focus-visible {
    outline: 2px solid
      color-mix(in oklab, var(--color-primary) 55%, transparent 45%);
    outline-offset: 4px;
  }

  .contact__submit:disabled {
    cursor: not-allowed;
    opacity: 0.65;
    transform: none;
    box-shadow: none;
    filter: none;
  }

  @media (min-width: 720px) {
    .contact__form-row {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (min-width: 800px) {
    .contact__panel-grid {
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
    }
  }

  @media (min-width: 960px) {
    .contact {
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      grid-template-areas:
        'heading details'
        'panel panel';
    }

    .contact__heading {
      grid-area: heading;
    }

    .contact__details {
      grid-area: details;
      align-self: stretch;
      grid-auto-rows: 1fr;
    }

    .contact__panel {
      grid-area: panel;
    }
  }

  @media (min-width: 640px) {
    .contact__channels {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
  }
</style>
