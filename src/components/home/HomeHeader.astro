---
import MobileNavInitializer from '../scripts/MobileNavInitializer.svelte';
import ThemeToggle from '../ui/ThemeToggle.svelte';

const navLinks = [
  { label: 'Overview', href: '#hero', id: 'overview' },
  { label: 'Experience', href: '#experience', id: 'experience' },
  { label: 'Projects', href: '#projects', id: 'projects' },
  { label: 'Skills', href: '#skills', id: 'skills' },
  { label: 'Contact', href: '#contact', id: 'contact' },
];
---

<header
  class="site-header"
  data-reveal
  data-js="site-header"
  data-testid="site-header"
>
  <div class="site-header__inner u-container">
    <button
      class="site-nav__toggle"
      type="button"
      aria-expanded="false"
      aria-controls="primary-navigation"
      aria-label="Open navigation menu"
      data-js="nav-toggle"
      data-state="closed"
      data-testid="primary-nav-toggle"
    >
      <span class="site-nav__toggle-icon" aria-hidden="true">
        <span class="site-nav__toggle-line"></span>
        <span class="site-nav__toggle-line"></span>
        <span class="site-nav__toggle-line"></span>
      </span>
      <span class="site-nav__toggle-label" data-js="nav-toggle-label">Menu</span
      >
    </button>
    <nav
      id="primary-navigation"
      class="site-nav"
      aria-label="Primary navigation"
      data-js="primary-navigation"
      data-state="open"
      data-testid="primary-navigation"
    >
      {
        navLinks.map((link) => (
          <a
            class="site-nav__link"
            href={link.href}
            data-testid={`primary-nav-link-${link.id}`}
          >
            {link.label}
          </a>
        ))
      }
      <div class="site-nav__theme-toggle-wrapper" data-js="mobile-theme-target">
      </div>
    </nav>
    <div
      class="site-header__theme-toggle-wrapper"
      data-js="desktop-theme-target"
    >
      <div class="site-header__theme-toggle" data-js="theme-toggle">
        <ThemeToggle client:idle />
      </div>
    </div>
  </div>
</header>

<style>
  .site-header {
    --glass-panel-glow: linear-gradient(
      145deg,
      color-mix(in oklab, var(--color-primary-strong) 12%, transparent 88%),
      transparent 65%
    );
    --glass-panel-tint: linear-gradient(
      125deg,
      color-mix(in oklab, var(--color-surface) 45%, transparent 55%),
      color-mix(in oklab, var(--color-surface-strong) 65%, transparent 35%)
    );
    --glass-panel-elevated: linear-gradient(
      130deg,
      color-mix(in oklab, var(--color-surface) 45%, transparent 55%),
      color-mix(in oklab, var(--color-surface-strong) 78%, transparent 22%)
    );
    --glass-panel-hover: linear-gradient(
      130deg,
      color-mix(in oklab, var(--color-surface) 52%, transparent 48%),
      color-mix(in oklab, var(--color-surface-strong) 85%, transparent 15%)
    );
    --glass-panel-border: color-mix(
      in oklab,
      var(--color-border) 55%,
      transparent 45%
    );
    --glass-panel-shadow: 0 24px 52px -28px
      color-mix(
        in oklab,
        var(--color-shadow, rgba(32, 22, 17, 0.65)) 45%,
        transparent 55%
      );
    background: var(--glass-panel-glow), var(--glass-panel-tint);
    border-bottom: 1px solid var(--glass-panel-border);
    box-shadow: var(--glass-panel-shadow);
    position: sticky;
    top: 0;
    inset-inline: 0;
    z-index: 10;
    padding-block-start: var(--safe-area-top, 0px);
    /* Backdrop-filter for glassmorphic effect */
    -webkit-backdrop-filter: blur(42px) saturate(165%) brightness(1.05);
    backdrop-filter: blur(42px) saturate(165%) brightness(1.05);
    transition:
      background var(--duration-base) var(--ease-smooth),
      border-color var(--duration-base) var(--ease-smooth),
      box-shadow var(--duration-base) var(--ease-smooth);
  }

  .site-header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-md);
    padding-block: clamp(var(--space-2xs), 1.2vw, var(--space-sm));
    flex-wrap: wrap;
    position: relative;
  }

  .site-nav {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: clamp(var(--space-2xs), 1.6vw, var(--space-sm));
  }

  .site-nav__link {
    display: inline-flex;
    align-items: center;
    font-family: var(--font-serif);
    font-size: var(--text-md);
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding-block: 0.25rem;
    padding-inline: 0.35rem;
    color: color-mix(
      in oklab,
      var(--color-text) 82%,
      var(--color-text-muted) 18%
    );
    transition: color var(--duration-base) var(--ease-smooth);
  }

  .site-nav__link:hover,
  .site-nav__link:focus-visible {
    color: var(--color-primary-strong);
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
  }

  .site-nav__toggle {
    display: none;
  }

  .site-nav__toggle-icon {
    display: inline-flex;
    position: relative;
    width: 1.25rem;
    height: 1rem;
    margin-inline-end: 0.35rem;
  }

  .site-nav__toggle-line {
    position: absolute;
    inset-inline: 0;
    height: 2px;
    border-radius: 999px;
    background: currentColor;
    transition:
      transform var(--duration-base) var(--ease-smooth),
      opacity var(--duration-base) var(--ease-smooth);
  }

  .site-nav__toggle-line:nth-child(1) {
    top: 0;
  }

  .site-nav__toggle-line:nth-child(2) {
    top: calc(50% - 1px);
  }

  .site-nav__toggle-line:nth-child(3) {
    bottom: 0;
  }

  .site-nav__toggle[data-state='open'] .site-nav__toggle-line:nth-child(1) {
    transform: translateY(7px) rotate(45deg);
  }

  .site-nav__toggle[data-state='open'] .site-nav__toggle-line:nth-child(2) {
    opacity: 0;
  }

  .site-nav__toggle[data-state='open'] .site-nav__toggle-line:nth-child(3) {
    transform: translateY(-7px) rotate(-45deg);
  }

  .site-nav__toggle-label {
    font-family: var(--font-sans);
    font-size: var(--text-sm);
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  .site-header__theme-toggle-wrapper {
    display: flex;
    align-items: center;
  }

  .site-header__theme-toggle {
    display: flex;
  }

  .site-nav__theme-toggle-wrapper {
    display: none;
  }

  :global(body.has-mobile-nav-open) {
    overflow: hidden;
  }

  @media (max-width: 48rem) {
    .site-header {
      background: transparent;
      border: none;
      box-shadow: none;
      --safe-area-top: env(safe-area-inset-top, 0px);
      --safe-area-right: env(safe-area-inset-right, 0px);
      --mobile-nav-offset: clamp(var(--space-sm), 4vw, var(--space-lg));
      --mobile-toggle-size: clamp(3.25rem, 11vw, 3.75rem);
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
    }

    .site-header__inner {
      flex-wrap: nowrap;
      align-items: center;
      padding: 0;
      position: static;
    }

    .site-nav {
      position: fixed;
      top: calc(
        var(--safe-area-top) + var(--mobile-nav-offset) +
          var(--mobile-toggle-size) + var(--space-2xs)
      );
      right: calc(var(--safe-area-right) + var(--mobile-nav-offset));
      left: auto;
      width: auto;
      max-width: min(22rem, calc(100vw - (var(--mobile-nav-offset) * 2)));
      flex-direction: column;
      align-items: flex-end;
      gap: clamp(var(--space-2xs), 2.6vw, var(--space-sm));
      padding: clamp(var(--space-sm), 4vw, var(--space-lg));
      border-radius: var(--radius-md);
      background: var(--glass-panel-glow), var(--glass-panel-elevated);
      border: 1px solid var(--glass-panel-border);
      box-shadow: var(--glass-panel-shadow);
      -webkit-backdrop-filter: blur(45px) saturate(175%) brightness(1.08);
      backdrop-filter: blur(45px) saturate(175%) brightness(1.08);
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0);
      transition:
        opacity var(--duration-base) var(--ease-smooth),
        transform var(--duration-base) var(--ease-smooth),
        visibility 0s linear;
      z-index: 8;
      text-align: right;
    }

    .site-nav[data-state='closed'] {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateY(-0.75rem);
      transition:
        opacity var(--duration-base) var(--ease-smooth),
        transform var(--duration-base) var(--ease-smooth),
        visibility 0s linear var(--duration-base);
    }

    .site-nav__link {
      width: auto;
      font-size: clamp(var(--text-md), 4.2vw, var(--text-lg));
      justify-content: flex-end;
      text-align: right;
    }

    .site-nav__toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-3xs);
      border: 1px solid var(--glass-panel-border);
      border-radius: 999px;
      width: var(--mobile-toggle-size);
      height: var(--mobile-toggle-size);
      padding: 0;
      background: var(--glass-panel-glow), var(--glass-panel-elevated);
      color: var(--color-text);
      cursor: pointer;
      transition:
        background var(--duration-base) var(--ease-smooth),
        transform var(--duration-base) var(--ease-smooth),
        box-shadow var(--duration-base) var(--ease-smooth);
      position: fixed;
      top: calc(var(--safe-area-top) + var(--mobile-nav-offset));
      right: calc(var(--safe-area-right) + var(--mobile-nav-offset));
      margin: 0;
      z-index: 10;
      box-shadow: var(--glass-panel-shadow);
      -webkit-backdrop-filter: blur(40px) saturate(170%) brightness(1.06);
      backdrop-filter: blur(40px) saturate(170%) brightness(1.06);
    }

    .site-nav__toggle:hover,
    .site-nav__toggle:focus-visible {
      background: var(--glass-panel-glow), var(--glass-panel-hover);
      transform: translateY(-1px);
    }

    .site-nav__toggle:focus-visible {
      outline: 3px solid
        color-mix(in oklab, var(--color-primary-strong) 65%, transparent 35%);
      outline-offset: 3px;
    }

    .site-nav__toggle-icon {
      margin: 0;
    }

    .site-nav__toggle-label {
      display: none;
    }

    .site-header__theme-toggle-wrapper {
      display: none;
    }

    .site-nav__theme-toggle-wrapper {
      display: flex;
      align-self: stretch;
      padding-top: clamp(var(--space-xs), 3vw, var(--space-md));
      border-top: 1px solid var(--glass-panel-border);
      justify-content: flex-end;
    }

    .site-nav__theme-toggle-wrapper :global(.toggle) {
      width: auto;
      justify-content: flex-end;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .site-nav,
    .site-nav[data-state='closed'],
    .site-nav__toggle-line,
    .site-nav__toggle {
      transition: none !important;
      transform: none !important;
    }
  }
</style>

<MobileNavInitializer client:load />
